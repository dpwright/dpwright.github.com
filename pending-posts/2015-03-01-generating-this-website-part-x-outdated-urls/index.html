<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        <meta name="viewport" content="width=650" />
        <title>Wright Access - Generating this website part x: Outdated URLs</title>
        <link rel="stylesheet" type="text/css" href="../../css/default.css" />
        <link rel="stylesheet" type="text/css" href="../../css/syntax.css" />
        <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.css" />
        <script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
        </script>
        <script>
          (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
          (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
          })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

          ga('create', 'UA-35158763-1', 'auto');
          ga('send', 'pageview');
        </script>
    </head>
    <body>
        <div id="header">
            <div id="logo">
             <h1 id="logomain"><a href="../../">Wright Access.</a></h1>
            </div>
            <div id="navigation">
                <a href="../../pages/about"><i class="fa fa-question-circle"></i></a>
            </div>
        </div>

        <div id="content">
            
              <h1 class="title">Generating this website part x: Outdated URLs</h1>
            
            

            <div class="info"> 1 March, 2015</div>



<p>On February 1st, 2015, I decided to change the URL scheme for this site, such that instead of outputting pages to <code>post-name.html</code> it would output to <code>post-name/index.html</code>. Unfortunately, this breaks any existing links to the original pages that might be out there. This module keeps those links active by generating any posts prior to that date at the original URL.</p>
<h2 id="imports">Imports</h2>
<p>Let’s get the obvious out the way…</p>
<div class="elastic-tabstops">
<table>
<colgroup>
<col width="100%" />
</colgroup>
<tbody>
<tr class="odd">
<td align="left"><pre class="sourceCode literate literatehaskell"><code class="sourceCode literatehaskell"><span class="ot">&gt;</span> <span class="ot">{-# LANGUAGE OverloadedStrings #-}</span></code></pre></td>
</tr>
<tr class="even">
<td align="left"><pre class="sourceCode literate literatehaskell"><code class="sourceCode literatehaskell"><span class="ot">&gt;</span> <span class="kw">module</span> <span class="dt">OutdatedURLs</span> <span class="kw">where</span></code></pre></td>
</tr>
<tr class="odd">
<td align="left"><pre class="sourceCode literate literatehaskell"><code class="sourceCode literatehaskell"><span class="ot">&gt;</span> <span class="kw">import </span><span class="dt">Hakyll</span></code></pre></td>
</tr>
</tbody>
</table>
</div>
<p>We’ll also import <em><code>Posts</code></em>, since for the most part we want to generate these posts exactly like their correctly-addressed counterparts.</p>
<div class="elastic-tabstops">
<table>
<colgroup>
<col width="100%" />
</colgroup>
<tbody>
<tr class="odd">
<td align="left"><pre class="sourceCode literate literatehaskell"><code class="sourceCode literatehaskell"><span class="ot">&gt;</span> <span class="kw">import </span><span class="dt">Posts</span></code></pre></td>
</tr>
</tbody>
</table>
</div>
<p>Finally, we import <code>Map</code> to look up metadata, and <code>Data.Time</code> so that we can check the dates. Note we hide <code>readTime</code> because we’re going to use the version from the <code>Posts</code> module.</p>
<div class="elastic-tabstops">
<table>
<colgroup>
<col width="100%" />
</colgroup>
<tbody>
<tr class="odd">
<td align="left"><pre class="sourceCode literate literatehaskell"><code class="sourceCode literatehaskell"><span class="ot">&gt;</span> <span class="kw">import qualified</span> <span class="dt">Data.Map</span> <span class="kw">as</span> <span class="dt">M</span></code></pre></td>
</tr>
<tr class="even">
<td align="left"><pre class="sourceCode literate literatehaskell"><code class="sourceCode literatehaskell"><span class="ot">&gt;</span> <span class="kw">import </span><span class="dt">Data.Time</span> <span class="kw">hiding</span> (readTime)</code></pre></td>
</tr>
</tbody>
</table>
</div>
<h2 id="setting-up-the-rules">Setting up the rules</h2>
<p>First we define the cut-off date, before which an old-style <code>.html</code> page will be created. This applies to any posts made prior to midnight, February 1st, 2015.</p>
<div class="elastic-tabstops">
<table>
<colgroup>
<col width="100%" />
</colgroup>
<tbody>
<tr class="odd">
<td align="left"><pre class="sourceCode literate literatehaskell"><code class="sourceCode literatehaskell"><span class="ot">&gt; cutoffDate ::</span> <span class="dt">UTCTime</span></code></pre></td>
</tr>
</tbody>
</table>
<table>
<colgroup>
<col width="0%" />
<col width="100%" />
</colgroup>
<tbody>
<tr class="odd">
<td align="left"><pre class="sourceCode literate literatehaskell"><code class="sourceCode literatehaskell"><span class="ot">&gt;</span> cutoffDate <span class="fu">=</span> <span class="dt">UTCTime</span> </code></pre></td>
<td align="left"><pre class="sourceCode haskell"><code class="sourceCode haskell">(fromGregorian <span class="dv">2015</span> <span class="dv">02</span> <span class="dv">01</span>)</code></pre></td>
</tr>
<tr class="even">
<td align="left"><pre class="sourceCode literate literatehaskell"><code class="sourceCode literatehaskell"><span class="ot">&gt;</span>                      </code></pre></td>
<td align="left"><pre class="sourceCode haskell"><code class="sourceCode haskell">(secondsToDiffTime <span class="dv">0</span>)</code></pre></td>
</tr>
</tbody>
</table>
</div>
<p>The <code>Rules</code> managing these posts are similar to those for <a href="../../posts/2014-09-29-generating-this-website-part-2-posts">standard <code>Posts</code></a>. We make use of the recently-added <code>matchMetadata</code> to compare the <code>date</code> field of the posts with our <code>cutoffDate</code>, and we tag the rule with the version “outdated” to avoid them showing up in the index. And of course we use <code>setExtension</code> rather than <code>simplifyURL</code>, since that’s the whole point of the exercise!</p>
<div class="elastic-tabstops">
<table>
<colgroup>
<col width="100%" />
</colgroup>
<tbody>
<tr class="odd">
<td align="left"><pre class="sourceCode literate literatehaskell"><code class="sourceCode literatehaskell"><span class="ot">&gt; outdatedURLs ::</span> <span class="dt">Tags</span> <span class="ot">-&gt;</span> <span class="dt">Rules</span> ()</code></pre></td>
</tr>
<tr class="even">
<td align="left"><pre class="sourceCode literate literatehaskell"><code class="sourceCode literatehaskell"><span class="ot">&gt;</span> outdatedURLs tags <span class="fu">=</span></code></pre></td>
</tr>
<tr class="odd">
<td align="left"><pre class="sourceCode literate literatehaskell"><code class="sourceCode literatehaskell"><span class="ot">&gt;</span>   matchMetadata <span class="st">&quot;posts/*&quot;</span> isOutdated <span class="fu">.</span> version <span class="st">&quot;outdated&quot;</span> <span class="fu">$</span></code></pre></td>
</tr>
</tbody>
</table>
<table>
<colgroup>
<col width="0%" />
<col width="0%" />
<col width="0%" />
<col width="100%" />
</colgroup>
<tbody>
<tr class="odd">
<td align="left"><pre class="sourceCode literate literatehaskell"><code class="sourceCode literatehaskell"><span class="ot">&gt;</span>   <span class="kw">do</span> </code></pre></td>
<td align="left"><pre class="sourceCode haskell"><code class="sourceCode haskell">route   </code></pre></td>
<td align="left"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span class="fu">$</span> </code></pre></td>
<td align="left"><pre class="sourceCode haskell"><code class="sourceCode haskell">metadataRoute dateAndTitle <span class="ot">`composeRoutes`</span></code></pre></td>
</tr>
<tr class="even">
<td align="left"><pre class="sourceCode literate literatehaskell"><code class="sourceCode literatehaskell"><span class="ot">&gt;</span>      </code></pre></td>
<td align="left"><pre class="sourceCode haskell"><code class="sourceCode haskell">        </code></pre></td>
<td align="left"><pre class="sourceCode haskell"><code class="sourceCode haskell">  </code></pre></td>
<td align="left"><pre class="sourceCode haskell"><code class="sourceCode haskell">setExtension <span class="st">&quot;.html&quot;</span></code></pre></td>
</tr>
<tr class="odd">
<td align="left"><pre class="sourceCode literate literatehaskell"><code class="sourceCode literatehaskell"><span class="ot">&gt;</span>      </code></pre></td>
<td align="left"><pre class="sourceCode haskell"><code class="sourceCode haskell">compile </code></pre></td>
<td align="left"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span class="fu">$</span> </code></pre></td>
<td align="left"><pre class="sourceCode haskell"><code class="sourceCode haskell">postCompiler tags</code></pre></td>
</tr>
</tbody>
</table>
<table>
<colgroup>
<col width="100%" />
</colgroup>
<tbody>
<tr class="odd">
<td align="left"><pre class="sourceCode literate literatehaskell"><code class="sourceCode literatehaskell"><span class="ot">&gt;</span>   <span class="kw">where</span></code></pre></td>
</tr>
</tbody>
</table>
<table>
<colgroup>
<col width="0%" />
<col width="100%" />
</colgroup>
<tbody>
<tr class="odd">
<td align="left"><pre class="sourceCode literate literatehaskell"><code class="sourceCode literatehaskell"><span class="ot">&gt;</span>     isOutdated </code></pre></td>
<td align="left"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span class="fu">=</span> maybe <span class="dt">False</span> checkDate <span class="fu">.</span> M.lookup <span class="st">&quot;date&quot;</span></code></pre></td>
</tr>
<tr class="even">
<td align="left"><pre class="sourceCode literate literatehaskell"><code class="sourceCode literatehaskell"><span class="ot">&gt;</span>     checkDate  </code></pre></td>
<td align="left"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span class="fu">=</span> (<span class="fu">&gt;</span> <span class="dv">0</span>) <span class="fu">.</span> diffUTCTime cutoffDate <span class="fu">.</span> readTime</code></pre></td>
</tr>
</tbody>
</table>
</div>
<h2 id="thats-it">That’s it!</h2>
<p>With just a small amount of effort, we’ve managed to completely change our URL scheme without breaking any old links. I wouldn’t want to make a habit of this sort of thing, but it’s good to know it can be resolved fairly easily should the need arise!</p>

<div class="tagsinfo">Tagged with: <a href="../../tags/hakyll">hakyll</a>, <a href="../../tags/literate-programs">literate-programs</a>, <a href="../../tags/generating%20this%20website">generating this website</a></div>

        </div>
        <div id="footer">
          <div id="text-licence">
            <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-sa/4.0/88x31.png" /></a><br />
            <span xmlns:dct="http://purl.org/dc/terms/" href="http://purl.org/dc/dcmitype/Text" property="dct:title" rel="dct:type">Wright Access</span> by <a xmlns:cc="http://creativecommons.org/ns#" href="http://dpwright.com/" property="cc:attributionName" rel="cc:attributionURL">Daniel P. Wright</a> is licensed under a<br />
            <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Attribution-ShareAlike 4.0 International License</a>.
          </div>
          <br />
          <div id="code-licence">
            All code is released under the <a href="../../pages/about#simplified-bsd-2-clause-license">BSD (2-Clause) License</a>.
          </div>
        </div>
    </body>
</html>
