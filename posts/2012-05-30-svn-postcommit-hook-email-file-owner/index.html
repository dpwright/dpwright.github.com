<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        <meta name="viewport" content="width=650" />
        <title>Wright Access - SVN post-commit hook: email file owner</title>
        <link rel="stylesheet" type="text/css" href="../../css/default.css" />
        <link rel="stylesheet" type="text/css" href="../../css/syntax.css" />
        <link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.css" />
        <script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
        </script>
        <script>
          (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
          (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
          })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

          ga('create', 'UA-35158763-1', 'auto');
          ga('send', 'pageview');
        </script>
    </head>
    <body>
        <div id="header">
            <div id="logo">
             <h1 id="logomain"><a href="../../">Wright Access.</a></h1>
            </div>
            <div id="navigation">
                <a href="../../pages/about"><i class="fa fa-question-circle"></i></a>
            </div>
        </div>

        <div id="content">
            
              <h1 class="title">SVN post-commit hook: email file owner</h1>
            
            

            <div class="info">30 May, 2012</div>



<p>It’s a common enough situation: we want SVN to email a notification to developers when somebody modifies a file they are in control of. SVN post-commit hooks let us send an email when the file is modified; but how do we determine to whom that email should be sent?</p>
<p>I came up with two solutions. Neither is very clever, but they both give a little clue at least. The first looks through the log and determines who has committed changes to that file the greatest number of times. The second looks at the blame log for the file to determine who has modified the most <em>lines</em> in the file. My script just emails both people</p>
<p>Just copy the script below and call it from your <code>post-commit</code> file to get started. You’ll want to change the value of DOMAIN to match the domain you want to email notifications to. The third parameter is the name of the project, so you can use the script for multiple repositories.</p>
<p>I just threw this script together so it’s nothing special – if you’d like to make improvements why not <a href="https://gist.github.com/2833953">fork the gist</a>?</p>
<div class="elastic-tabstops">
<table>
<colgroup>
<col width="100%" />
</colgroup>
<tbody>
<tr class="odd">
<td align="left"><pre class="sourceCode bash"><code class="sourceCode bash"><span class="co">#!/usr/bin/env bash</span></code></pre></td>
</tr>
<tr class="even">
<td align="left"><pre class="sourceCode bash"><code class="sourceCode bash"></code></pre></td>
</tr>
<tr class="odd">
<td align="left"><pre class="sourceCode bash"><code class="sourceCode bash"><span class="ot">LOOK=</span>/usr/bin/svnlook</code></pre></td>
</tr>
<tr class="even">
<td align="left"><pre class="sourceCode bash"><code class="sourceCode bash"><span class="ot">REPOS=</span><span class="st">&quot;</span><span class="ot">$1</span><span class="st">&quot;</span></code></pre></td>
</tr>
<tr class="odd">
<td align="left"><pre class="sourceCode bash"><code class="sourceCode bash"><span class="ot">REV=</span><span class="st">&quot;</span><span class="ot">$2</span><span class="st">&quot;</span></code></pre></td>
</tr>
<tr class="even">
<td align="left"><pre class="sourceCode bash"><code class="sourceCode bash"><span class="ot">PROJECT=</span><span class="st">&quot;</span><span class="ot">$3</span><span class="st">&quot;</span></code></pre></td>
</tr>
<tr class="odd">
<td align="left"><pre class="sourceCode bash"><code class="sourceCode bash"></code></pre></td>
</tr>
<tr class="even">
<td align="left"><pre class="sourceCode bash"><code class="sourceCode bash"><span class="ot">AUTHOR=$($LOOK</span> <span class="kw">author</span> <span class="ot">$REPOS</span> -r <span class="ot">$REV)</span></code></pre></td>
</tr>
<tr class="odd">
<td align="left"><pre class="sourceCode bash"><code class="sourceCode bash"></code></pre></td>
</tr>
<tr class="even">
<td align="left"><pre class="sourceCode bash"><code class="sourceCode bash"><span class="ot">DOMAIN=</span>domain.com</code></pre></td>
</tr>
<tr class="odd">
<td align="left"><pre class="sourceCode bash"><code class="sourceCode bash"></code></pre></td>
</tr>
<tr class="even">
<td align="left"><pre class="sourceCode bash"><code class="sourceCode bash"><span class="ot">OWNERS=</span><span class="st">&quot;&quot;</span></code></pre></td>
</tr>
<tr class="odd">
<td align="left"><pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">for</span> <span class="kw">FILE</span> in <span class="ot">$($LOOK</span> <span class="kw">changed</span> <span class="ot">$REPOS</span> -r <span class="ot">$REV</span> <span class="kw">|</span> <span class="kw">awk</span> <span class="st">'{ print $2 }'</span><span class="ot">)</span></code></pre></td>
</tr>
<tr class="even">
<td align="left"><pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">do</span></code></pre></td>
</tr>
<tr class="odd">
<td align="left"><pre class="sourceCode bash"><code class="sourceCode bash">        <span class="ot">OWNER_LOG=$(</span><span class="kw">svn</span> log <span class="st">&quot;file://</span><span class="ot">$REPOS</span><span class="st">/</span><span class="ot">$FILE</span><span class="st">&quot;</span> <span class="kw">2&gt;</span> /dev/null <span class="kw">|</span> <span class="kw">grep</span> <span class="st">&quot;^r[0-9]* | &quot;</span> <span class="kw">|</span> <span class="kw">awk</span> <span class="st">'{ print $3 }'</span> <span class="kw">|</span> <span class="kw">sort</span> <span class="kw">|</span> <span class="kw">uniq</span> -c <span class="kw">|</span> <span class="kw">sort</span> <span class="kw">|</span> <span class="kw">tail</span> -n 1 <span class="kw">|</span> <span class="kw">awk</span> <span class="st">'{ print $2 }'</span><span class="ot">)</span></code></pre></td>
</tr>
<tr class="even">
<td align="left"><pre class="sourceCode bash"><code class="sourceCode bash">        <span class="kw">if [[</span> <span class="st">&quot;</span><span class="ot">$OWNER_LOG</span><span class="st">&quot;</span> <span class="ot">!=</span> <span class="st">&quot;</span><span class="ot">$AUTHOR</span><span class="st">&quot;</span> &amp;&amp; <span class="st">&quot;</span><span class="ot">$OWNERS</span><span class="st">&quot;</span> <span class="ot">!=</span> *<span class="st">&quot; </span><span class="ot">$OWNER_LOG</span><span class="st"> &quot;</span>*<span class="kw"> ]]</span></code></pre></td>
</tr>
<tr class="odd">
<td align="left"><pre class="sourceCode bash"><code class="sourceCode bash">        <span class="kw">then</span></code></pre></td>
</tr>
<tr class="even">
<td align="left"><pre class="sourceCode bash"><code class="sourceCode bash">                <span class="ot">OWNERS=</span><span class="st">&quot;</span><span class="ot">$OWNERS</span><span class="st"> </span><span class="ot">$OWNER_LOG</span><span class="st"> &quot;</span></code></pre></td>
</tr>
<tr class="odd">
<td align="left"><pre class="sourceCode bash"><code class="sourceCode bash">        <span class="kw">fi</span></code></pre></td>
</tr>
<tr class="even">
<td align="left"><pre class="sourceCode bash"><code class="sourceCode bash"></code></pre></td>
</tr>
<tr class="odd">
<td align="left"><pre class="sourceCode bash"><code class="sourceCode bash">        <span class="ot">OWNER_BLAME=$(</span><span class="kw">svn</span> blame -x <span class="st">&quot;-w --ignore-eol-style&quot;</span> <span class="st">&quot;file://</span><span class="ot">$REPOS</span><span class="st">/</span><span class="ot">$FILE</span><span class="st">&quot;</span> <span class="kw">2&gt;</span> /dev/null <span class="kw">|</span> <span class="kw">awk</span> <span class="st">'{ print $2 }'</span> <span class="kw">|</span> <span class="kw">sort</span> <span class="kw">|</span> <span class="kw">uniq</span> -c <span class="kw">|</span> <span class="kw">sort</span> <span class="kw">|</span> <span class="kw">tail</span> -n 1 <span class="kw">|</span> <span class="kw">awk</span> <span class="st">'{ print $2 }'</span><span class="ot">)</span></code></pre></td>
</tr>
<tr class="even">
<td align="left"><pre class="sourceCode bash"><code class="sourceCode bash">        <span class="kw">if [[</span> <span class="st">&quot;</span><span class="ot">$OWNER_BLAME</span><span class="st">&quot;</span> <span class="ot">!=</span> <span class="st">&quot;&quot;</span> &amp;&amp; <span class="st">&quot;</span><span class="ot">$OWNER_BLAME</span><span class="st">&quot;</span> <span class="ot">!=</span> <span class="st">&quot;</span><span class="ot">$AUTHOR</span><span class="st">&quot;</span> &amp;&amp; <span class="st">&quot;</span><span class="ot">$OWNERS</span><span class="st">&quot;</span> <span class="ot">!=</span> *<span class="st">&quot; </span><span class="ot">$OWNER_BLAME</span><span class="st"> &quot;</span>*<span class="kw"> ]]</span></code></pre></td>
</tr>
<tr class="odd">
<td align="left"><pre class="sourceCode bash"><code class="sourceCode bash">        <span class="kw">then</span></code></pre></td>
</tr>
<tr class="even">
<td align="left"><pre class="sourceCode bash"><code class="sourceCode bash">                <span class="ot">OWNERS=</span><span class="st">&quot;</span><span class="ot">$OWNERS</span><span class="st"> </span><span class="ot">$OWNER_BLAME</span><span class="st"> &quot;</span></code></pre></td>
</tr>
<tr class="odd">
<td align="left"><pre class="sourceCode bash"><code class="sourceCode bash">        <span class="kw">fi</span></code></pre></td>
</tr>
<tr class="even">
<td align="left"><pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">done</span></code></pre></td>
</tr>
<tr class="odd">
<td align="left"><pre class="sourceCode bash"><code class="sourceCode bash"></code></pre></td>
</tr>
<tr class="even">
<td align="left"><pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">if [[</span> <span class="st">&quot;</span><span class="ot">$OWNERS</span><span class="st">&quot;</span> <span class="ot">!=</span> <span class="st">&quot;&quot;</span><span class="kw"> ]]</span></code></pre></td>
</tr>
<tr class="odd">
<td align="left"><pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">then</span></code></pre></td>
</tr>
<tr class="even">
<td align="left"><pre class="sourceCode bash"><code class="sourceCode bash">        <span class="ot">RECIPIENTS=$(</span><span class="kw">for</span> <span class="kw">PERSON</span> in <span class="ot">$OWNERS</span><span class="kw">;</span> <span class="kw">do</span> <span class="kw">echo</span> -n <span class="st">&quot;--to </span><span class="ot">$PERSON</span><span class="st">@</span><span class="ot">$DOMAIN</span><span class="st"> &quot;</span><span class="kw">;</span> </code></pre></td>
</tr>
<tr class="odd">
<td align="left"><pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">done</span>)</code></pre></td>
</tr>
<tr class="even">
<td align="left"><pre class="sourceCode bash"><code class="sourceCode bash"></code></pre></td>
</tr>
<tr class="odd">
<td align="left"><pre class="sourceCode bash"><code class="sourceCode bash">        <span class="kw">/usr/local/bin/svnnotify</span>                          <span class="dt">\\</span></code></pre></td>
</tr>
<tr class="even">
<td align="left"><pre class="sourceCode bash"><code class="sourceCode bash">            <span class="kw">--repos-path</span>     <span class="st">&quot;</span><span class="ot">$REPOS</span><span class="st">&quot;</span>                     <span class="dt">\\</span></code></pre></td>
</tr>
<tr class="odd">
<td align="left"><pre class="sourceCode bash"><code class="sourceCode bash">            <span class="kw">--revision</span>       <span class="st">&quot;</span><span class="ot">$REV</span><span class="st">&quot;</span>                       <span class="dt">\\</span></code></pre></td>
</tr>
<tr class="even">
<td align="left"><pre class="sourceCode bash"><code class="sourceCode bash">            <span class="kw">--subject-prefix</span> <span class="st">&quot;[</span><span class="ot">$PROJECT</span><span class="st">-svn]&quot;</span>             <span class="dt">\\</span></code></pre></td>
</tr>
<tr class="odd">
<td align="left"><pre class="sourceCode bash"><code class="sourceCode bash">            <span class="kw">--attach-diff</span>                                 <span class="dt">\\</span></code></pre></td>
</tr>
<tr class="even">
<td align="left"><pre class="sourceCode bash"><code class="sourceCode bash">            <span class="kw">--diff-switches</span>  <span class="st">'-x &quot;-w --ignore-eol-style&quot;'</span> <span class="dt">\\</span></code></pre></td>
</tr>
<tr class="odd">
<td align="left"><pre class="sourceCode bash"><code class="sourceCode bash">            <span class="kw">--user-domain</span>    <span class="ot">$DOMAIN</span>                      <span class="dt">\\</span></code></pre></td>
</tr>
<tr class="even">
<td align="left"><pre class="sourceCode bash"><code class="sourceCode bash">            <span class="ot">$RECIPIENTS</span></code></pre></td>
</tr>
<tr class="odd">
<td align="left"><pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">fi</span></code></pre></td>
</tr>
</tbody>
</table>
</div>

<div class="tagsinfo">Tagged with: <a href="../../tags/bash">bash</a>, <a href="../../tags/scripts">scripts</a>, <a href="../../tags/subversion">subversion</a></div>

        </div>
        <div id="footer">
          <div id="text-licence">
            <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-sa/4.0/88x31.png" /></a><br />
            <span xmlns:dct="http://purl.org/dc/terms/" href="http://purl.org/dc/dcmitype/Text" property="dct:title" rel="dct:type">Wright Access</span> by <a xmlns:cc="http://creativecommons.org/ns#" href="http://dpwright.com/" property="cc:attributionName" rel="cc:attributionURL">Daniel P. Wright</a> is licensed under a<br />
            <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Attribution-ShareAlike 4.0 International License</a>.
          </div>
          <br />
          <div id="code-licence">
            All code is released under the <a href="../../pages/about#simplified-bsd-2-clause-license">BSD (2-Clause) License</a>.
          </div>
        </div>
    </body>
</html>
