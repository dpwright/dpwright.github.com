
<!DOCTYPE html>
<html lang="ja">
  <head>
    <!-- include head -->
    

<meta charset="utf-8">
<title>SVN post-commit hook: email file owner - Wright Access</title>
<meta name="author" content="Daniel P. Wright">
<meta name="description"
      content="It&#8217;s a common enough situation: we want SVN to email a notification to
developers when somebody modifies a file they are in control of. SVN &hellip;">


<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1">

<link rel="canonical" href="http://dpwright.github.com/blog/2012/05/30/svn-post-commit-hook-email-file-owner">
<link href="/favicon.png" rel="icon">
<link href="/stylesheets/screen.css"
      media="screen, projection"
      rel="stylesheet"
      type="text/css">
<link href="/atom.xml"
      rel="alternate"
      title="Wright Access"
      type="application/atom+xml">


<script src="/javascripts/modernizr-2.0.js" type="text/javascript"></script>
<script src="/javascripts/ender.js" type="text/javascript"></script>
<script src="/javascripts/octopress.js" type="text/javascript"></script>


<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-35158763-1']);
  _gaq.push(['_trackPageview']);  
  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') +
      '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>


    <!-- /include -->
  </head>
  <body>
    <div id="wrapper">

      <header role="banner" class="site_metas">
	<!-- include header -->
	
<hgroup>
  <h1><a href="/">Wright Access</a></h1>
  
  <h2>dpwright's notes on code, Japan, Japanese, and anything else.</h2>
  
</hgroup>

	<!-- /include -->
        <!-- include social_service_links -->
	

        <!-- /include -->
      </header>

      <div id="content">
	<!-- content -->
	

  


<article class="entry" role="article">

  <header>
    
  </header>

  <div class="entry_content"><p>It&#8217;s a common enough situation: we want SVN to email a notification to
developers when somebody modifies a file they are in control of. SVN post-commit
hooks let us send an email when the file is modified; but how do we determine to
whom that email should be sent?</p>

<p>I came up with two solutions. Neither is very clever, but they both give a
little clue at least. The first looks through the log and determines who has
committed changes to that file the greatest number of times. The second looks at
the blame log for the file to determine who has modified the most <em>lines</em> in the
file. My script just emails both people</p>

<p>Just copy the script below and call it from your <code>post-commit</code> file to get
started. You&#8217;ll want to change the value of DOMAIN to match the domain you want
to email notifications to. The third parameter is the name of the project, so
you can use the script for multiple repositories.</p>

<p>I just threw this script together so it&#8217;s nothing special &#8211; if you&#8217;d like to
make improvements why not <a href="https://gist.github.com/2833953">fork the gist</a>?</p>

<div><script src='https://gist.github.com/2833953.js?file=svn-notify-hook.sh'></script>
<noscript><pre><code>#!/usr/bin/env bash

LOOK=/usr/bin/svnlook
REPOS=&quot;$1&quot;
REV=&quot;$2&quot;
PROJECT=&quot;$3&quot;

AUTHOR=$($LOOK author $REPOS -r $REV)

DOMAIN=domain.com

OWNERS=&quot;&quot;
for FILE in $($LOOK changed $REPOS -r $REV | awk '{ print $2 }')
do
        OWNER_LOG=$(svn log &quot;file://$REPOS/$FILE&quot; 2&gt; /dev/null | grep &quot;^r[0-9]* | &quot; | awk '{ print $3 }' | sort | uniq -c | sort | tail -n 1 | awk '{ print $2 }')
        if [[ &quot;$OWNER_LOG&quot; != &quot;$AUTHOR&quot; &amp;&amp; &quot;$OWNERS&quot; != *&quot; $OWNER_LOG &quot;* ]]
        then
                OWNERS=&quot;$OWNERS $OWNER_LOG &quot;
        fi

        OWNER_BLAME=$(svn blame -x &quot;-w --ignore-eol-style&quot; &quot;file://$REPOS/$FILE&quot; 2&gt; /dev/null | awk '{ print $2 }' | sort | uniq -c | sort | tail -n 1 | awk '{ print $2 }')
        if [[ &quot;$OWNER_BLAME&quot; != &quot;&quot; &amp;&amp; &quot;$OWNER_BLAME&quot; != &quot;$AUTHOR&quot; &amp;&amp; &quot;$OWNERS&quot; != *&quot; $OWNER_BLAME &quot;* ]]
        then
                OWNERS=&quot;$OWNERS $OWNER_BLAME &quot;
        fi
done

if [[ &quot;$OWNERS&quot; != &quot;&quot; ]]
then
        RECIPIENTS=$(for PERSON in $OWNERS; do echo -n &quot;--to $PERSON@$DOMAIN &quot;; 
done)

        /usr/local/bin/svnnotify                          \\
            --repos-path     &quot;$REPOS&quot;                     \\
            --revision       &quot;$REV&quot;                       \\
            --subject-prefix &quot;[$PROJECT-svn]&quot;             \\
            --attach-diff                                 \\
            --diff-switches  '-x &quot;-w --ignore-eol-style&quot;' \\
            --user-domain    $DOMAIN                      \\
            $RECIPIENTS
fi
</code></pre></noscript></div>



</div>

  <footer>
    <p class="meta">

      

      
      <time datetime="2012-05-30 14:36:00 +0900" pubdate>2012年05月30日</time>
      

      
      <span class="categories">
	<a class='category' href='/blog/categories/bash/'>bash</a>, <a class='category' href='/blog/categories/scripts/'>scripts</a>, <a class='category' href='/blog/categories/subversion/'>subversion</a>
      </span>
      

    </p>

    
    <div class="sharing">

      

      

      
    </div>
    

    
    <section>
      <h3 id="comments">Comments</h3>
      <div id="disqus_thread" aria-live="polite">
	<noscript>
	  Javascript を有効にしないとコメントを見ることができません。
	  (<a href="http://disqus.com/?ref_noscript">Disqus</a>)
	</noscript>
      </div>
    </section>
    

  </footer>
  
</div>

	<!-- /content -->
      </div>

      <footer role="contentinfo">
	<!-- include footer -->
	<p>
  Copyright &copy; 2012 - Daniel P. Wright -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

	<!-- /include -->
      </footer>
      
      <!-- include after_footer -->
      

<script type="text/javascript">
      var disqus_shortname = 'writeaccess';
      
	
	// var disqus_developer = 1;
	var disqus_identifier = 'http://dpwright.github.com/blog/2012/05/30/svn-post-commit-hook-email-file-owner';
	var disqus_url = 'http://dpwright.github.com/blog/2012/05/30/svn-post-commit-hook-email-file-owner';
	var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>




      <!-- /include -->

    </div>
  </body>
</html>
