
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>SVN post-commit hook: email file owner - Wright Access</title>
  <meta name="author" content="Daniel P. Wright">

  
  <meta name="description" content="It&#8217;s a common enough situation: we want SVN to email a notification to
developers when somebody modifies a file they are in control of. SVN &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://dpwright.github.com/blog/2012/05/30/svn-post-commit-hook-email-file-owner/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="Wright Access" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-35158763-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Wright Access</a></h1>
  
    <h2>dpwright's notes on code, Japan, Japanese, and anything else.</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:dpwright.github.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">SVN Post-commit Hook: Email File Owner</h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-05-30T14:36:00+09:00" pubdate data-updated="true">May 30<span>th</span>, 2012</time>
        
      </p>
    
  </header>


<div class="entry-content"><p>It&#8217;s a common enough situation: we want SVN to email a notification to
developers when somebody modifies a file they are in control of. SVN post-commit
hooks let us send an email when the file is modified; but how do we determine to
whom that email should be sent?</p>

<p>I came up with two solutions. Neither is very clever, but they both give a
little clue at least. The first looks through the log and determines who has
committed changes to that file the greatest number of times. The second looks at
the blame log for the file to determine who has modified the most <em>lines</em> in the
file. My script just emails both people</p>

<p>Just copy the script below and call it from your <code>post-commit</code> file to get
started. You&#8217;ll want to change the value of DOMAIN to match the domain you want
to email notifications to. The third parameter is the name of the project, so
you can use the script for multiple repositories.</p>

<p>I just threw this script together so it&#8217;s nothing special &#8211; if you&#8217;d like to
make improvements why not <a href="https://gist.github.com/2833953">fork the gist</a>?</p>

<div><script src='https://gist.github.com/2833953.js?file=svn-notify-hook.sh'></script>
<noscript><pre><code>#!/usr/bin/env bash

LOOK=/usr/bin/svnlook
REPOS=&quot;$1&quot;
REV=&quot;$2&quot;
PROJECT=&quot;$3&quot;

AUTHOR=$($LOOK author $REPOS -r $REV)

DOMAIN=domain.com

OWNERS=&quot;&quot;
for FILE in $($LOOK changed $REPOS -r $REV | awk '{ print $2 }')
do
        OWNER_LOG=$(svn log &quot;file://$REPOS/$FILE&quot; 2&gt; /dev/null | grep &quot;^r[0-9]* | &quot; | awk '{ print $3 }' | sort | uniq -c | sort | tail -n 1 | awk '{ print $2 }')
        if [[ &quot;$OWNER_LOG&quot; != &quot;$AUTHOR&quot; &amp;&amp; &quot;$OWNERS&quot; != *&quot; $OWNER_LOG &quot;* ]]
        then
                OWNERS=&quot;$OWNERS $OWNER_LOG &quot;
        fi

        OWNER_BLAME=$(svn blame -x &quot;-w --ignore-eol-style&quot; &quot;file://$REPOS/$FILE&quot; 2&gt; /dev/null | awk '{ print $2 }' | sort | uniq -c | sort | tail -n 1 | awk '{ print $2 }')
        if [[ &quot;$OWNER_BLAME&quot; != &quot;&quot; &amp;&amp; &quot;$OWNER_BLAME&quot; != &quot;$AUTHOR&quot; &amp;&amp; &quot;$OWNERS&quot; != *&quot; $OWNER_BLAME &quot;* ]]
        then
                OWNERS=&quot;$OWNERS $OWNER_BLAME &quot;
        fi
done

if [[ &quot;$OWNERS&quot; != &quot;&quot; ]]
then
        RECIPIENTS=$(for PERSON in $OWNERS; do echo -n &quot;--to $PERSON@$DOMAIN &quot;; 
done)

        /usr/local/bin/svnnotify                          \\
            --repos-path     &quot;$REPOS&quot;                     \\
            --revision       &quot;$REV&quot;                       \\
            --subject-prefix &quot;[$PROJECT-svn]&quot;             \\
            --attach-diff                                 \\
            --diff-switches  '-x &quot;-w --ignore-eol-style&quot;' \\
            --user-domain    $DOMAIN                      \\
            $RECIPIENTS
fi
</code></pre></noscript></div>



</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Daniel P. Wright</span></span>

      








  


<time datetime="2012-05-30T14:36:00+09:00" pubdate data-updated="true">May 30<span>th</span>, 2012</time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/bash/'>bash</a>, <a class='category' href='/blog/categories/scripts/'>scripts</a>, <a class='category' href='/blog/categories/subversion/'>subversion</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://dpwright.github.com/blog/2012/05/30/svn-post-commit-hook-email-file-owner/" data-via="danielpwright" data-counturl="http://dpwright.github.com/blog/2012/05/30/svn-post-commit-hook-email-file-owner/" >Tweet</a>
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2012/05/11/file-specific-merge-resolution-in-git/" title="Previous Post: File-specific merge resolution in git">&laquo; File-specific merge resolution in git</a>
      
      
        <a class="basic-alignment right" href="/blog/2012/06/05/git-alias-to-open-all-diffs-in-vim-tabs/" title="Next Post: Git alias to open all diffs in vim tabs">Git alias to open all diffs in vim tabs &raquo;</a>
      
    </p>
  </footer>
</article>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2012/09/25/git-script-to-rebase-all-child-branches-following-a-command/">Git script to rebase all child branches following a command</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/08/01/git-alias-to-get-a-git-commit-sha1-from-an-svn-revision-number-in-git-svn/">Git alias to get a git commit sha1 from an SVN revision number in git-svn</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/06/26/git-alias-to-amend-old-commits/">Git alias to amend old commits</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/06/25/bash-oneliner-watch-a-filesize/">Bash oneliner: watch a filesize</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/06/05/git-alias-to-open-all-diffs-in-vim-tabs/">Git alias to open all diffs in vim tabs</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating...</li>
  </ul>
  
  <a href="https://github.com/dpwright">@dpwright</a> on GitHub
  
  <script type="text/javascript">
    $.domReady(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'dpwright',
            count: 0,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>


<section>
  <h1>Latest Tweets</h1>
  <ul id="tweets">
    <li class="loading">Status updating...</li>
  </ul>
  <script type="text/javascript">
    $.domReady(function(){
      getTwitterFeed("danielpwright", 4, false);
    });
  </script>
  <script src="/javascripts/twitter.js" type="text/javascript"> </script>
  
    <a href="http://twitter.com/danielpwright" class="twitter-follow-button" data-show-count="false">Follow @danielpwright</a>
  
</section>





  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2012 - Daniel P. Wright -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
