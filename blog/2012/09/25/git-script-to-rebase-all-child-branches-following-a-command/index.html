
<!DOCTYPE html>
<html lang="ja">
  <head>
    <!-- include head -->
    

<meta charset="utf-8">
<title>Git script to rebase all child branches following a command - Wright Access</title>
<meta name="author" content="Daniel P. Wright">
<meta name="description"
      content="This script looks at the current status of the DAG to find the children of the
current branch, runs an action, then rebases those children. It is &hellip;">


<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1">

<link rel="canonical" href="http://www.dpwright.com//blog/2012/09/25/git-script-to-rebase-all-child-branches-following-a-command">
<link href="/favicon.png" rel="icon">
<link href="/stylesheets/screen.css"
      media="screen, projection"
      rel="stylesheet"
      type="text/css">
<link href="/atom.xml"
      rel="alternate"
      title="Wright Access"
      type="application/atom+xml">


<script src="/javascripts/modernizr-2.0.js" type="text/javascript"></script>
<script src="/javascripts/ender.js" type="text/javascript"></script>
<script src="/javascripts/octopress.js" type="text/javascript"></script>


<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-35158763-1']);
  _gaq.push(['_trackPageview']);  
  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') +
      '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>


    <!-- /include -->
  </head>
  <body>
    <div id="wrapper">

      <header role="banner" class="site_metas">
	<!-- include header -->
	
<hgroup>
  <h1><a href="/">Wright Access</a></h1>
  
  <h2>dpwright's notes on code, Japan, Japanese, and anything else.</h2>
  
</hgroup>

	<!-- /include -->
        <!-- include social_service_links -->
	

        <!-- /include -->
      </header>

      <div id="content">
	<!-- content -->
	

  


<article class="entry" role="article">

  <header>
    
  </header>

  <div class="entry_content"><p>This script looks at the current status of the DAG to find the children of the
current branch, runs an action, then rebases those children.  It is particularly
useful for users of <code>git-svn</code>, who may find themselves having to rebase all
topic branches (and sub-topics which build off those) every time they <code>git svn
rebase</code> or <code>git svn dcommit</code>.</p>

<p>For pure git projects, this is considered by many to be bad form, so use with
discretion.  People who like a linear history might like it.</p>

<p>I expect the script, in its current state, will fail in cases where the rebase
can&#8217;t be done automatically, but for simple day-to-day operations it makes
<code>git-svn</code> that bit less painful to use :-)</p>

<div><script src='https://gist.github.com/3779324.js?file=git-rar.rb'></script>
<noscript><pre><code>#!/usr/bin/ruby
#GistID: 3779324

require 'escape'

exit if ARGV.empty?

current_branch = `git symbolic-ref -q HEAD`.sub(/^refs\/heads\//, &quot;&quot;).strip
exit if current_branch.empty?

IGNORED_BRANCHES = `git branch -r --no-color`.sub(/^[ *]*/, &quot;&quot;).split(&quot;\n&quot;).collect{ |e| e.strip } &lt;&lt; &quot;HEAD&quot;

def branches_on(commit)
    log = `git log --pretty=%d --simplify-by-decoration #{commit} | head -n 1`
    branches = log.sub(/^ \(([^)]+)\).*$/, '\1').split(&quot;, &quot;)
    branches.collect{ |e| e.strip }.reject{ |b| (IGNORED_BRANCHES &lt;&lt; commit).include? b }
end

def children_of(branch)
    log = `git branch --no-color --contains #{branch} | sed 's/^[ *]*//' | grep -v \&quot;^#{branch}$\&quot;`
    log.split(&quot;\n&quot;)
end

def branch_tree_from(branch)
    siblings = branches_on branch
    children = children_of(branch).reject{|c| siblings.include? c}
    if children.empty?
        return [branch]
    else
        return [branch, siblings.collect{|s| [s]} + children.collect{|c| branch_tree_from(c)}]
    end
end

def rebase_all_children(tree)
    parent = tree.shift
    children = tree.shift
    children.map do |e|
        system &quot;git rebase #{parent} #{e.first}&quot;

        if e.size &gt; 1
            rebase_all_children e
        end
    end
end

initial_tree = branch_tree_from current_branch

if system &quot;git #{Escape.shell_command(ARGV)}&quot;
    rebase_all_children initial_tree
    system &quot;git checkout #{current_branch}&quot;
end</code></pre></noscript></div>


<p>I have an alias set up to invoke it with <code>git rar</code> (&#8220;Run and Rebase&#8221;), so that I
can type, for example, <code>git rar svn rebase</code>.</p>
</div>

  <footer>
    <p class="meta">

      

      
      <time datetime="2012-09-25 10:27:00 +0900" pubdate>2012年09月25日</time>
      

      
      <span class="categories">
	<a class='category' href='/blog/categories/alias/'>alias</a>, <a class='category' href='/blog/categories/git/'>git</a>, <a class='category' href='/blog/categories/git-svn/'>git-svn</a>, <a class='category' href='/blog/categories/ruby/'>ruby</a>, <a class='category' href='/blog/categories/scripts/'>scripts</a>
      </span>
      

    </p>

    
    <div class="sharing">

      

      

      
    </div>
    

    
    <section>
      <h3 id="comments">Comments</h3>
      <div id="disqus_thread" aria-live="polite">
	<noscript>
	  Javascript を有効にしないとコメントを見ることができません。
	  (<a href="http://disqus.com/?ref_noscript">Disqus</a>)
	</noscript>
      </div>
    </section>
    

  </footer>
  
</div>

	<!-- /content -->
      </div>

      <footer role="contentinfo">
	<!-- include footer -->
	<p>
  Copyright &copy; 2012 - Daniel P. Wright -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

	<!-- /include -->
      </footer>
      
      <!-- include after_footer -->
      

<script type="text/javascript">
      var disqus_shortname = 'wrightaccess';
      
	
	// var disqus_developer = 1;
	var disqus_identifier = 'http://www.dpwright.com//blog/2012/09/25/git-script-to-rebase-all-child-branches-following-a-command';
	var disqus_url = 'http://www.dpwright.com//blog/2012/09/25/git-script-to-rebase-all-child-branches-following-a-command';
	var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>




      <!-- /include -->

    </div>
  </body>
</html>
